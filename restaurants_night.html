<!DOCTYPE html>
<html lang="ko">
<head>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link rel="stylesheet" href="styles.css" />
    <script defer src="script.js"></script>
  <title>서울의 밤 맛집 검색</title>
  <style>
    /* ── 폰트 불러오기 ── */
    @font-face {
      font-family: 'Shilla_CultureB-Bold';
      src: url('./AnyConv.com__Shilla_Culture(B).woff') format('woff');
      font-weight: 700; font-style: normal;
    }
    .bg-night {
  background-image: url('https://raw.githubusercontent.com/valencia0960/image/refs/heads/main/%EB%B0%B0%EA%B2%BD1.jpg');
  opacity: 0.3;
}
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: sans-serif;
      background: #f4f4f4;
    }
    
    /* ── 본문 컨테이너 ── */
    .container {
      max-width: 800px; margin: 40px auto;
      padding: 0 20px;
    }
    .container h1 {
      margin-bottom: 20px;
      font-family: 'Shilla_CultureB-Bold', sans-serif;
      font-size: 24px;
    }
    /* 검색창 */
    .search-box {
      display: flex; margin-bottom: 20px;
    }
    .search-box input {
      flex: 1; padding: 8px 12px; font-size: 16px;
      border: 1px solid #ccc; border-radius: 4px 0 0 4px;
      outline: none;
    }
    .search-box button {
      padding: 8px 16px; font-size: 16px;
      border: 1px solid #000; background: #000;
      color: #fff; cursor: pointer;
      border-radius: 0 4px 4px 0;
    }
    .search-box button:disabled {
      background: #666; cursor: not-allowed;
    }
    /* 검색 결과 */
    #result-list {
      list-style: none; padding: 0;
    }
    #result-list li {
      background: #fff; border: 1px solid #ddd;
      border-radius: 4px; padding: 12px; margin-bottom: 12px;
    }
    #result-list li h2 {
      margin-bottom: 6px; font-size: 20px;
      font-family: 'Shilla_CultureB-Bold', sans-serif;
    }
    #result-list li p {
      margin: 4px 0; font-size: 14px;
    }

    /* ── 평점 ≥4.0인 맛집 10곳 랜덤 ── */
    #top-restaurants {
      margin-top: 40px;
    }
    #top-restaurants h2 {
      font-family: 'Shilla_CultureB-Bold', sans-serif;
      font-size: 20px; margin-bottom: 10px;
    }
    .rest-grid {
      display: flex; flex-wrap: wrap; gap: 10px;
    }
    .rest-card {
      width: 120px; text-align: center;
      font-family: sans-serif;
    }
    .rest-card img {
      width: 100%; height: 80px;
      object-fit: cover; border-radius: 4px;
    }
    .rest-card p {
      margin: 4px 0; font-size: 14px;
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }
  </style>
</head>
  <body>
    <!-- 배경 레이어 -->
    <div class="bg-layer bg-day"></div>
    <div class="bg-layer bg-night"></div>
  
    <header class="site-header">
      <div class="logo">SeoulDayNight</div>
       <nav>
      <ul class="nav-list"></ul>
     </nav>
       <!-- 액션 버튼들 래퍼 -->
    <div class="header-actions">
      <!-- 탐험하기: 발자국 아이콘 -->
      <button class="btn-cta" aria-label="탐험하기">
        <!-- 간단한 발자국 SVG -->
         <a href="./footprints.html"></a>
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
          <path d="M4.5 15C3.67 15 3 15.67 3 16.5C3 17.33 3.67 18 4.5 18C5.33 18 6 17.33 6 16.5C6 15.67 5.33 15 4.5 15ZM9 13.5C8.07 13.5 7.29 14.08 7.08 15H12.92C12.71 14.08 11.93 13.5 11 13.5H9ZM15.5 12C14.67 12 14 12.67 14 13.5C14 14.33 14.67 15 15.5 15C16.33 15 17 14.33 17 13.5C17 12.67 16.33 12 15.5 12ZM19.5 9C18.67 9 18 9.67 18 10.5C18 11.33 18.67 12 19.5 12C20.33 12 21 11.33 21 10.5C21 9.67 20.33 9 19.5 9Z"/>
        </svg>
      </button>
  
      <!-- 로그인 버튼 -->
      <button class="btn-login"><a href="./login.html">로그인</a></button>
    </div>
    </header>

  <div class="container">
    <h1>서울의 밤 맛집 검색</h1>

    <!-- 검색창 -->
    <div class="search-box">
      <input type="text" id="search-input" placeholder="맛집 이름을 입력하세요" />
      <button id="search-btn" disabled>검색</button>
    </div>

    <!-- 검색 결과 -->
    <ul id="result-list">
      <li id="no-data">맛집 이름을 입력하고 검색 버튼을 눌러주세요.</li>
    </ul>

    <!-- 평점 ≥4.0인 맛집 10곳 랜덤 -->
    <section id="top-restaurants">
      <h2>추천 평점 맛집 10선 (평점 ≥4.0)</h2>
      <div class="rest-grid" id="rest-grid"></div>
    </section>
  </div>

  <!-- 숨겨진 맵 컨테이너 (Google Places 용) -->
  <div id="map" style="display:none;"></div>

  <script>
    const API_KEY       = '6149786b6976616c36306976665363';
    const RESPONSE_TYPE = 'json';
    const SERVICE_NAME  = 'LOCALDATA_072404';
    const START_INDEX   = 1;
    const END_INDEX     = 500;

    const apiUrl =
      `http://openapi.seoul.go.kr:8088/${API_KEY}/${RESPONSE_TYPE}/` +
      `${SERVICE_NAME}/${START_INDEX}/${END_INDEX}`;

    let spots = [];

    // 초기 데이터 로드 (검색용)
    async function initData() {
      try {
        const res  = await fetch(apiUrl);
        const json = await res.json();
        if (json[SERVICE_NAME].RESULT.CODE !== 'INFO-000') {
          throw new Error(json[SERVICE_NAME].RESULT.MESSAGE);
        }
        spots = json[SERVICE_NAME].row || [];
        document.getElementById('search-btn').disabled = false;
      } catch (err) {
        console.error('맛집 데이터 로드 실패:', err);
        document.getElementById('no-data').textContent =
          '맛집 정보를 불러오는 중 오류가 발생했습니다.';
      }
    }

    // 검색 처리
    function doSearch() {
      const keyword = document.getElementById('search-input')
                              .value.trim().toLowerCase();
      const listEl  = document.getElementById('result-list');
      listEl.innerHTML = '';

      if (!keyword) {
        listEl.innerHTML = '<li>맛집 이름을 입력하고 검색 버튼을 눌러주세요.</li>';
        return;
      }

      const filtered = spots.filter(item =>
        item.BPLCNM.toLowerCase().includes(keyword)
      );

      if (filtered.length === 0) {
        listEl.innerHTML = `<li>“${keyword}”에 해당하는 맛집이 없습니다.</li>`;
        return;
      }

      listEl.innerHTML = filtered.map(item => `
        <li>
          <h2>${item.BPLCNM}</h2>
          <p><strong>주소:</strong> ${item.RDNWHLADDR}</p>
          <p><strong>전화:</strong> ${item.SITETEL || '정보 없음'}</p>
        </li>
      `).join('');
    }

    document.addEventListener('DOMContentLoaded', () => {
      initData();
      document.getElementById('search-btn')
              .addEventListener('click', doSearch);
      document.getElementById('search-input')
              .addEventListener('keyup', e => {
        document.getElementById('search-btn').disabled = !e.target.value.trim();
        if (e.key === 'Enter' && e.target.value.trim()) doSearch();
      });
    });

    // Google Places API: 평점 ≥4.0인 맛집 10곳 랜덤
    let map, placesService;
    function initMap() {
      map = new google.maps.Map(document.getElementById('map'));
      placesService = new google.maps.places.PlacesService(map);

      const center = { lat: 37.5665, lng: 126.9780 };
      placesService.nearbySearch({
        location: center,
        radius: 1000,
        type: 'restaurant'
      }, (results, status) => {
        if (status !== google.maps.places.PlacesServiceStatus.OK) return;
        const good = results.filter(r => r.rating >= 4.0);
        // 랜덤 10개 뽑기
        const pick = [];
        const copy = good.slice();
        while (pick.length < 10 && copy.length) {
          const idx = Math.floor(Math.random() * copy.length);
          pick.push(copy.splice(idx, 1)[0]);
        }
        // 렌더링
        const grid = document.getElementById('rest-grid');
        grid.innerHTML = pick.map(p => {
          const img = p.photos
            ? p.photos[0].getUrl({ maxWidth:120, maxHeight:80 })
            : 'images/placeholder.jpg';
          return `
            <div class="rest-card">
              <img src="${img}" alt="${p.name}">
              <p title="${p.name}">${p.name}</p>
            </div>
          `;
        }).join('');
      });
    }
  </script>
  <script
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAy_DG0i7oZwJ6TauuoiylGTDI_SO4pi2Y&libraries=places&callback=initMap"
    async defer>
  </script>
</body>
</html>
