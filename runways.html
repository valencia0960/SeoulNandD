<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>산책로 추천 | SeoulDayNight</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    /* ─── 공통 헤더/네비 ─── */
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family:sans-serif; background:#f0f0f0; }
    .site-header {
      display:flex; align-items:center; justify-content:space-between;
      background:rgba(255,255,255,0.8); backdrop-filter:blur(10px);
      padding:1rem 2rem; border-radius:8px; margin-bottom:1rem;
    }
    .logo { font-size:1.5rem; font-weight:bold; }
    .nav-list { list-style:none; display:flex; gap:1rem; }
    .nav-list a { text-decoration:none; color:#333; }
    .nav-list .active { color:#0066cc; font-weight:700; }
    .header-actions a {
      margin-left:1rem; text-decoration:none;
      background:#0066cc; color:#fff;
      padding:.5rem 1rem; border-radius:4px;
      transition:background .2s;
    }
    .header-actions a:hover { background:#0055aa; }

    /* ─── 히어로 ─── */
    .hero {
      position:relative; height:300px;
      border-radius:8px; overflow:hidden;
      margin-bottom:1rem;
      background:url('https://raw.githubusercontent.com/valencia0960/image/refs/heads/main/%EB%B0%B0%EA%B2%BD1.jpg')
        center/cover no-repeat;
    }
    .hero-overlay { position:absolute; inset:0; background:rgba(0,0,0,0.4); }
    .hero-text {
      position:relative; color:#fff;
      font-size:3rem; text-align:center; line-height:300px;
    }

    /* ─── 컨트롤 패널 ─── */
    .control-panel {
      max-width:600px; margin:0 auto 1rem;
      display:flex; gap:.5rem; padding:0 1rem;
    }
    .control-panel input {
      flex:1; padding:.75rem 1rem; font-size:1rem;
      border:1px solid #ccc; border-radius:4px; outline:none;
    }
    .control-panel button {
      padding:.75rem 1.5rem; font-size:1rem;
      border:none; background:#0066cc; color:#fff;
      border-radius:4px; cursor:pointer;
      transition:background .2s;
    }
    .control-panel button:hover { background:#0055aa; }
    .control-panel .reset-btn {
      background:#cc0000;
    }
    .control-panel .reset-btn:hover {
      background:#aa0000;
    }

    /* ─── 맵 ─── */
    #map {
      width:100%; height:500px; max-width:1200px;
      margin:0 auto 2rem; border-radius:8px; overflow:hidden;
    }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="logo">SeoulDayNight</div>
    <nav>
      <ul class="nav-list">
        <li><a href="index.html">Home</a></li>
        <li><a href="index.html#hero-day">서울의 낮</a></li>
        <li><a href="index.html#hero-night">서울의 밤</a></li>
        <li><a href="#" class="active">산책로 추천</a></li>
        <li><a href="attractions_night.html">야경 명소</a></li>
      </ul>
    </nav>
    <div class="header-actions">
      <a href="footprints.html">탐험하기</a>
      <a href="login.html">로그인</a>
    </div>
  </header>

  <section class="hero">
    <div class="hero-overlay"></div>
    <h1 class="hero-text">산책로 직접 그리기</h1>
  </section>

  <div class="control-panel">
    <input id="start-input" type="text" placeholder="출발지 입력">
    <input id="end-input"   type="text" placeholder="도착지 입력">
    <button id="route-btn">경로 생성</button>
    <button id="reset-btn" class="reset-btn">리셋</button>
  </div>

  <div id="map">지도 로딩 중…</div>

  <!-- Google Maps JS API -->
  <script
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAy_DG0i7oZwJ6TauuoiylGTDI_SO4pi2Y&callback=initMap"
    async defer>
  </script>
  <script>
  let map, geocoder, directionsService, directionsRenderer;
  let startMarker, endMarker;

  function initMap() {
    map = new google.maps.Map(document.getElementById('map'), {
      center:{lat:37.5665,lng:126.9780}, zoom:13
    });
    geocoder = new google.maps.Geocoder();
    directionsService = new google.maps.DirectionsService();
    directionsRenderer = new google.maps.DirectionsRenderer({
      map, suppressMarkers: false,
      polylineOptions:{strokeColor:'#FF0000',strokeWeight:5}
    });
  }

  document.addEventListener('DOMContentLoaded', () => {
    const si = document.getElementById('start-input');
    const ei = document.getElementById('end-input');
    const rb = document.getElementById('route-btn');
    const rs = document.getElementById('reset-btn');

    function clearAll() {
      if (startMarker) startMarker.setMap(null);
      if (endMarker)   endMarker.setMap(null);
      directionsRenderer.set('directions', null);
      map.setCenter({lat:37.5665, lng:126.9780});
      map.setZoom(13);
      si.value = '';
      ei.value = '';
    }

    function geocodePromise(address) {
      return new Promise((resolve, reject) => {
        geocoder.geocode({ address }, (results, status) => {
          if (status === 'OK' && results[0]) {
            resolve(results[0].geometry.location);
          } else {
            reject(status);
          }
        });
      });
    }

    rb.addEventListener('click', () => {
      const startAddr = si.value.trim();
      const endAddr   = ei.value.trim();
      if (!startAddr||!endAddr) {
        alert('출발지와 도착지를 모두 입력하세요.');
        return;
      }
      clearAll();
      // 1) geocode both in parallel
      Promise.all([ geocodePromise(startAddr), geocodePromise(endAddr) ])
        .then(([startLoc, endLoc]) => {
          startMarker = new google.maps.Marker({ map, position: startLoc, label:'A' });
          endMarker   = new google.maps.Marker({ map, position: endLoc,   label:'B' });
          // 2) DirectionsService 도보 요청
          return new Promise((resolve, reject) => {
            directionsService.route({
              origin: startLoc,
              destination: endLoc,
              travelMode: google.maps.TravelMode.WALKING
            }, (res, status) => {
              if (status === 'OK') resolve(res);
              else reject(status);
            });
          });
        })
        .then(directionResult => {
          // 3) 성공: 지도에 경로 표시
          directionsRenderer.setDirections(directionResult);
          // 확대/센터
          const bounds = new google.maps.LatLngBounds();
          directionResult.routes[0].overview_path.forEach(pt => bounds.extend(pt));
          map.fitBounds(bounds);
        })
        .catch(err => {
          if (err === 'ZERO_RESULTS') {
            alert('Google에서 도보 경로를 찾을 수 없습니다.\n'
                + '주소를 다시 확인하거나, 가까운 지점으로 시도해 보세요.');
          } else {
            alert('오류가 발생했습니다: ' + err);
          }
        });
    });

    rs.addEventListener('click', clearAll);
  });
  </script>
</body>
</html>
