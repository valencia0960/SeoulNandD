<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ëª…ì†Œ ìƒì„¸ ë³´ê¸° | SeoulDayNight</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    /* â”€â”€â”€ ê³µí†µ í—¤ë”/ë„¤ë¹„ â”€â”€â”€ */
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family:sans-serif; background:#fafafa; }
    .site-header {
      display:flex;
      align-items:center;
      justify-content:space-between;
      background:rgba(255,255,255,0.8);
      backdrop-filter:blur(10px);
      padding:1rem 2rem;
      margin-bottom:1rem;
      border-radius:8px;
    }
    .logo { font-size:1.5rem; font-weight:bold; }
    .nav-list { list-style:none; display:flex; gap:1rem; }
    .nav-list a { text-decoration:none; color:#333; }
    .nav-list .active { color:#0066cc; font-weight:700; }
    .header-actions a {
      margin-left:1rem;
      text-decoration:none;
      background:#0066cc;
      color:#fff;
      padding:.5rem 1rem;
      border-radius:4px;
      transition:background .2s;
    }
    .header-actions a:hover { background:#0055aa; }

    /* â”€â”€â”€ ì»¨í…ì¸  â”€â”€â”€ */
    .container { max-width:800px; margin:0 auto; padding:0 1rem; }
    h2 { font-size:2rem; margin-bottom:1rem; color:#333; }
    p { margin:0.5rem 0; line-height:1.6; color:#555; }
    p strong { color:#222; }
    .inline-img {
      display:block;
      width:100%;
      max-height:400px;
      object-fit:cover;
      margin:1rem 0;
      border-radius:8px;
    }

    /* â”€â”€â”€ ì¢‹ì•„ìš” ë²„íŠ¼ â”€â”€â”€ */
    #like-btn {
      display:inline-block;
      padding:0.5rem 1rem;
      background:#e74c3c;
      color:#fff;
      border:none;
      border-radius:4px;
      cursor:pointer;
      font-size:1rem;
      transition:background .2s;
    }
    #like-btn.liked {
      background:#c0392b;
    }
  </style>
</head>
<body>
  <!-- í—¤ë” -->
  <header class="site-header">
    <div class="logo">SeoulDayNight</div>
    <nav>
      <ul class="nav-list">
        <li><a href="seoul2.html">Home</a></li>
        <li><a href="attractions_night.html" class="active">ì•¼ê²½ ëª…ì†Œ</a></li>
        <li><a href="restaurants_night.html">ì•¼ê°„ ë§›ì§‘</a></li>
        <li><a href="events.html">ì•¼ê°„ ì´ë²¤íŠ¸</a></li>
      </ul>
    </nav>
    <div class="header-actions">
      <a href="footprints.html" aria-label="íƒí—˜í•˜ê¸°">íƒí—˜í•˜ê¸°</a>
      <a href="login.html">ë¡œê·¸ì¸</a>
    </div>
  </header>

  <!-- ìƒì„¸ ì»¨í…ì¸  -->
  <div class="container" id="detail">
    <h2 id="detail-title">ë¡œë”© ì¤‘â€¦</h2>
    <div id="detail-content"><!-- ìŠ¤í¬ë¦½íŠ¸ê°€ ì±„ì›ë‹ˆë‹¤ --></div>
    <button id="like-btn">â¤ï¸ ì¢‹ì•„ìš”</button>
  </div>

  <script>
    (async function(){
      const params = new URLSearchParams(location.search);
      const title  = params.get('title');
      if (!title) {
        document.getElementById('detail-title').textContent = 'ì˜ëª»ëœ ìš”ì²­';
        return;
      }

      // OpenAPI í˜¸ì¶œ
      const API_KEY  = '586b44485376616c38365263715054';
      const RESPONSE = 'json';
      const SERVICE  = 'viewNightSpot';
      const START    = 1, END = 500;
      const apiUrl   =
        `http://openapi.seoul.go.kr:8088/${API_KEY}/${RESPONSE}/${SERVICE}/${START}/${END}`;

      try {
        const res  = await fetch(apiUrl);
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const json = await res.json();
        const rows = json[SERVICE]?.row || [];
        const item = rows.find(r => r.TITLE === title);
        if (!item) throw new Error('ëª…ì†Œ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');

        // ì´ë¯¸ì§€ URL ê²°ì •
        const imgUrl = item.FIRSTIMAGE
          ? item.FIRSTIMAGE
          : `https://maps.googleapis.com/maps/api/staticmap?center=${item.Y},${item.X}` +
            `&zoom=15&size=800x400&markers=${item.Y},${item.X}` +
            `&key=AIzaSyAy_DG0i7oZwJ6TauuoiylGTDI_SO4pi2Y`;

        // ìƒì„¸ HTML
        const html = `
          <p><strong>ì£¼ì†Œ:</strong> ${item.ADDR || 'ì •ë³´ ì—†ìŒ'}</p>
          <p><strong>ìš´ì˜ì‹œê°„:</strong> ${item.OPERATING_TIME || 'ì •ë³´ ì—†ìŒ'}</p>
          <p><strong>ìš”ê¸ˆ:</strong> ${item.ENTR_FEE || 'ë¬´ë£Œ'}</p>
          <img class="inline-img"
               src="${imgUrl}"
               alt="${item.TITLE}"
               onerror="this.onerror=null;this.src='images/placeholder.jpg';">
          <p><strong>ì„¤ëª…:</strong> ${item.CONTENTS || 'ì—†ìŒ'}</p>
          <p><strong>êµí†µ-ì§€í•˜ì² :</strong> ${item.SUBWAY || 'ì—†ìŒ'}</p>
          <p><strong>êµí†µ-ë²„ìŠ¤:</strong> ${item.BUS || 'ì—†ìŒ'}</p>
        `;
        document.getElementById('detail-title').textContent = item.TITLE;
        document.getElementById('detail-content').innerHTML = html;

        // ì¢‹ì•„ìš” ìƒíƒœ
        const likeBtn = document.getElementById('like-btn');
        const storageKey = `liked:${item.TITLE}`;
        if (localStorage.getItem(storageKey) === '1') {
          likeBtn.classList.add('liked');
          likeBtn.textContent = 'ğŸ’– ì¢‹ì•„ìš”';
        }
        likeBtn.addEventListener('click', () => {
          if (localStorage.getItem(storageKey) === '1') {
            localStorage.removeItem(storageKey);
            likeBtn.classList.remove('liked');
            likeBtn.textContent = 'â¤ï¸ ì¢‹ì•„ìš”';
          } else {
            localStorage.setItem(storageKey, '1');
            likeBtn.classList.add('liked');
            likeBtn.textContent = 'ğŸ’– ì¢‹ì•„ìš”';
          }
        });

      } catch (err) {
        console.error(err);
        document.getElementById('detail').innerHTML =
          `<h2>ì˜¤ë¥˜</h2><p>${err.message}</p>`;
      }
    })();
  </script>
</body>
</html>
